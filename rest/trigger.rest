### WhatsApp Trigger API Testing (Enhanced .a1 Report Function)
### Base URL: http://localhost:3001/api/trigger

@baseUrl = http://localhost:3001/api/trigger

### 1. Get trigger configuration and status (read-only)
GET {{baseUrl}}
Content-Type: application/json

### 2. Enable triggers globally (triggers are enabled by default)
POST {{baseUrl}}/status
Content-Type: application/json

{
  "enabled": true
}

### 3. Disable triggers globally
POST {{baseUrl}}/status
Content-Type: application/json

{
  "enabled": false
}

### 4. Test invalid status update (non-boolean)
POST {{baseUrl}}/status
Content-Type: application/json

{
  "enabled": "yes"
}

### 5. Test enhanced triggers via WhatsApp:
### Send these messages to your WhatsApp bot to test:
###
### A. Enhanced .a1 trigger (report function) - TEXT MESSAGES:
### - ".a1 laporan ada kerusakan plafond" â†’ Should respond with formatted report + send webhook
### - ".a1 ada masalah di kantor" â†’ Should respond with formatted report + send webhook
### - ".a1 kerusakan AC ruang meeting" â†’ Should respond with formatted report + send webhook
### - ".a1" â†’ Should respond with usage instructions
###
### B. Enhanced .a1 trigger (report function) - MEDIA MESSAGES:
### - Send an IMAGE with caption ".a1 foto kerusakan plafond" â†’ Should respond with formatted report including "Tipe: Gambar" + send webhook with image URL
### - Send a VIDEO with caption ".a1 video masalah AC" â†’ Should respond with formatted report including "Tipe: Video" + send webhook
### - Send a DOCUMENT with caption ".a1 laporan lengkap kerusakan" â†’ Should respond with formatted report including "Tipe: Dokumen" + send webhook
### - Send media without caption or with empty caption â†’ Should be ignored (no trigger response)
###
### C. Simple triggers:
### - ".help" â†’ Should respond with available commands (reply: true)
### - ".ping" â†’ Should NOT respond (reply: false) - Silent processing only

### Note: Triggers are now hardcoded and cannot be modified via API
### Available hardcoded triggers:
### - .a1 <pesan> â†’ Creates formatted report with sender info, timestamp, and message
### - .help â†’ Shows available commands with enhanced formatting  
### - .ping â†’ Simple pong response
### 
### Enhanced .a1 trigger response format:
### ðŸ“‹ LAPORAN DITERIMA
###
### Pelapor: [WhatsApp Display Name]
### Nomor HP: [Phone Number from WhatsApp]
### Waktu: [Indonesian Timestamp - Asia/Jakarta timezone]
### Tipe: [Message Type - always shown: Teks/Gambar/Video/Dokumen/Audio/etc]
### Pesan: [Message content without .a1 prefix]
###
### Status: âœ… Laporan telah diterima dan akan diproses
###
### Example usage:
### TEXT MESSAGE:
### Input: ".a1 laporan ada kerusakan plafond"
### Output: Formatted report with sender details, timestamp, and "Tipe: Teks"
###
### MEDIA MESSAGE:
### Input: Image with caption ".a1 foto kerusakan plafond"
### Output: Formatted report with sender details, timestamp, and "Tipe: Gambar"
###
### USAGE HELP:
### Input: ".a1"
### Output: "Format: .a1 <pesan laporan>\nContoh: .a1 laporan ada kerusakan plafond"
###
### NEW FEATURES:
###
### 1. REPLY PARAMETER:
### Each trigger now has a "reply" parameter (true/false):
### - .a1: reply: true â†’ Will send WhatsApp reply message
### - .help: reply: true â†’ Will send WhatsApp reply message
### - .ping: reply: false â†’ Will process silently (no reply sent)
###
### 2. WEBHOOK INTEGRATION:
### .a1 trigger now sends webhook data to configured endpoint before replying:
### - Endpoint: http://localhost:4600/api/webhook/whatsapp (configurable via WEBHOOK_ENDPOINT)
### - Method: POST
### - Payload format:
### {
###   "waUser": {
###     "name": "User Display Name",
###     "phone": "087733760363"
###   },
###   "task": {
###     "title": "Report content without .a1 prefix",
###     "category": "CM"
###   },
###   "evidence": "https://image-url-if-available.jpg",
###   "waMessageId": "whatsapp-message-id"
### }
###
### 3. WEBHOOK CONFIGURATION:
### Environment variables for webhook:
### - WEBHOOK_ENDPOINT: Target webhook URL
### - WEBHOOK_TIMEOUT: Request timeout (default: 10000ms)
### - WEBHOOK_RETRIES: Retry attempts (default: 3)
### - WEBHOOK_ENABLED: Enable/disable webhook (default: true)
###
### Triggers are enabled by default when server starts
### Only global enable/disable functionality is available via API
### Function-based triggers (.a1) process message content dynamically
### Webhook failures do not prevent normal trigger responses